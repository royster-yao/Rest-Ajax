<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="root">
      <h1>请登录以后在做操作</h1>
      <h2 id="info"></h2>
      <form>
        <div>用户名:<input id="username" type="text" /></div>
        <div>密码:<input id="password" type="password" /></div>
        <div>
          <button type="button" id="login-btn">登录</button>
        </div>
      </form>
    </div>

    <script>
      // 点击login-btn后实现登录功能
      const loginBtn = document.getElementById("login-btn")
      const root = document.getElementById("root")
      loginBtn.onclick = () => {
        // 获取用户输入的用户名和密码
        const username = document.getElementById("username").value.trim()
        const password = document.getElementById("password").value.trim()
        // 调用fetch发送请求完成登录
        fetch("http://localhost:3000/login", {
          method: "POST",
          headers: {
            "Content-type": "application/json",
          },
          body: JSON.stringify({ username, password }),
        })
          .then((res) => res.json())
          .then((res) => {
            if (res.status !== "OK") {
              throw new Error("用户名或密码错误")
            }

            // 登录成功以后，需要保持用户的登录状态，需要将用户的信息储存到某个地方
            // 需要将用户信息存储到本地存储

            /*
              所谓的本地存储就是浏览器自身的存储空间
                可以将用户的数据存储到浏览器内部
                sessionStorage 中存储的数据 页面一关闭数据就会丢失
                localStorage 存储的时间比较长
            */
            // localStorage
            // sessionStorage
            // console.log(res)
            // 登录成功

            root.innerHTML = `
                <h1>欢迎${res.data.nickname} 回来！</h1>
                <hr>
                <button id="load-btn">加载数据</button>
            `
          })
          .catch((err) => {
            // console.log("出错了！", err)
            // 登陆失败
            document.getElementById("info").innerText = "用户名或密码错误"
          })
      }
    </script>
  </body>
</html>
